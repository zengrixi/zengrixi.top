---
layout: mypost
title: 什么是进程
categories: [进程, 操作系统]
---

*进程的非正式定义非常简单：进程就是运行中的程序。程序本身是没有生命周期的，它知识存在硬盘上面的一些指令（也可能是一些静态数据）。是操作系统让这些字节运行起来，让程序发挥作用。*

**虽然只有少量的物理CPU可用，但是操作系统如何提供几乎有无数个CPU可用的假象？**

操作系统通过**虚拟化（virtualizing）**CPU来提供这种假象。通过让一个进程只运行一个时间片，然后切换到其他进程，操作系统提供了存在多个虚拟CPU的假象。这就是**时分共享（time sharing）**CPU技术，允许用户如愿以偿运行多个并发进程。潜在的开销就是性能损失，因为如果CPU必须共享，每个进程的运行就会慢一点。

> 时分共享（time sharing）是操作系统共享资源所使用的最基本的技术之一。通过允许资源由一个实体使用一小段时间，然后由另一个实体使用一小段时间，如此下去，所谓的资源（例如，CPU或网络连接）可以被许多人共享。时分共享的自然对应技术是空分共享，资源在空间上被划分给希望使用它的人。例如，磁盘空间自然是一个空分共享资源，因为一旦将块分配给文件，在用户删除文件之前，不可能将它分配给其他文件。

**构成进程的是什么？**

为了理解构成进程的是什么，我们必须理解它的机器状态（machine state）：程序在运行时可以读取或更新的内容。在任何时刻，机器的哪些部分对执行该程序很重要？

- **内存**

进程的机器状态有一个明显的组成部分，就是它的内存。指令存在内存中。正在运行的程序读取和写入的数据也在内存中。因此进程可以访问的内存（称为地址空间，address space）是该进程的一部分。

- **寄存器**

进程的机器状态的另一部分是寄存器。许多指令明确地读取或更新寄存器，因此显然，他们对于执行该进程很重要。

*有一些非常特殊的寄存器构成了该机器状态的一部分。例如，程序计数器（Program Counter，PC）（有时称为指令指针，Instruction Pointer或IP）告诉我们程序当前正在执行哪个指令：类似的，栈指针（stack pointer）和相关的帧指针（frame pointer）用于管理函数参数栈、局部变量和返回地址。*

#### 进程创建

操作系统运行程序必须做的第一件事情是将代码和所有静态数据（例如初始化变量）加载到内存中，加载到进程的地址空间中。程序最初以某种可执行格式驻留在硬盘上。<u>因此，将程序和静态数据加载到内存中的过程，需要操作系统从磁盘读取这些字节，并将它们放在内存中的某处。</u>

将代码和静态数据加载到内存后，操作系统在运行此进程之前还需要执行其他一些操作。必须为程序的运行栈（run-time stack）分配一些内存。

*（C程序使用栈存放局部变量、函数参数和返回地址。操作系统分配这些内存，并提供给进程，操作系统也可能会用参数初始化栈。具体来说，它会将参数填入main()函数，即argc和argv数组。）*

操作系统也可能为程序的堆（heap）分配一些内存。

*（C程序中，堆用于显示请求的动态分配数据。程序通过调用malloc()来请求这样的空间，并通过调用free()来明确地释放它。）*

> 数据结构（如链表、散列表、树和其他数据结构）需要堆。起初堆会很小。随着程序的运行，通过malloc()库API请求更多内存，操作系统可能会参与分配更多内存给进程，以满足这些调用。

操作系统还将执行一些其他初始化任务，特别是与输入/输出（I/O）相关的任务。

*（例如linux系统中3个打开的文件描述符。）*

**OS进行完这些操作后，就会启动程序然后将CPU的控制权转移到新创建的进程中，从而程序开始执行。**

#### 进程状态

进程可以处于以下3种状态之一。

* **运行（running）**：在运行状态下，进程正在处理器上执行指令。
* **就绪（ready）**：在就绪状态下，进程已经准备好运行，但由于某些原因，操作系统选择不在此时运行。
* **阻塞（blocked）**：在阻塞状态下，一个进程执行了某种操作，直到发生其他事件时才会准备运行。

待续...